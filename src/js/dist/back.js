!function(){"use strict";const e="SRData";function n(e){const n=document.createElement("div");return n.id="set-randomizer--warning",n.innerHTML=e,n.style.cssText="color: firebrick;font-size: 40%; background-color: white; border: 2px solid red; margin: 40px 10px 0px; padding: 15px; text-shadow: 0px 0px; ",n}const r={star:!0};function t(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function o(e,n){let o,i;const s={},c=function(n=e.cssSelector){if(o=!1,i=!1,s[n])return s[n];try{return s[n]=document.querySelectorAll(n)}catch{return o=!0,s[n]=document.createDocumentFragment().childNodes}},l={},d=function(n=e.cssSelector){if(l[n])return l[n];{const e=c(n);if(!e||0===e.length)return o=!0,l[n]="";const r=[...e].map(e=>e.innerHTML).join("%%sr%%ELEMDELIM%%");return(r.includes("SET RANDOMIZER FRONT TEMPLATE")||r.includes("SET RANDOMIZER BACK TEMPLATE"))&&(i=!0),l[n]=r}},a=(e.isRegex?e.openDelim:t(e.openDelim))+"((?:.|\\n|\\r)*?)"+(e.isRegex?e.closeDelim:t(e.closeDelim)),u={},p=function(n=e.cssSelector){if(u[n])return u[n];{const e=[],r=d(n);let t;try{t=RegExp(a,"gm")}catch{return o=!0,u[n]=[]}let i=t.exec(r);for(;i;)e.push(i[1]),i=t.exec(r);return u[n]=e}},m={},f=function(r=e.cssSelector){if(m[r])return m[r];{const t=[],o=p(r);for(const[r,i]of o.entries()){const o=i.split(e.isRegex?new RegExp(e.fieldSeparator):e.fieldSeparator).map((e,t)=>[n,r,t,e,"n"]);t.push(o)}return m[r]=t}},g=function(n,o,i,s,l,a,u,m=e.cssSelector){const x=function(e,n){const r=e.find(e=>"default"===e.name).stylings;return e.forEach(e=>{["colors","classes"].forEach(r=>{e.stylings[r].randomIndices=n[e.name]?n[e.name][r]:[],e.stylings[r].nextIndex=0})}),{defaultStyle:r,propAccessor:function(n,t=null,o=r){const i=n?e.find(e=>e.name===n).stylings:null,s=t?e.find(e=>e.name===t).stylings:null,c=function(e=null,n=null){return e&&n?s&&s[e]&&void 0!==s[e][n]?s[e][n]:i&&i[e]&&void 0!==i[e][n]?i[e][n]:o[e][n]:e?s&&void 0!==s[e]?s[e]:i&&void 0!==i[e]?i[e]:o[e]:s||i||o};let l;return{getProp:c,getNextIndex:function(e){let n;const r=c(e),t=c(e,"values").length;return void 0===l?r.collectiveIndexing&&r.randomStartIndex?0===r.randomIndices.length?(n=Math.floor(Math.random()*t),r.randomIndices.push(n)):n=0===r.nextIndex?r.randomIndices[0]:r.nextIndex%t:r.collectiveIndexing?n=r.nextIndex%t:r.randomStartIndex?(r.setIndex||(r.setIndex=0),void 0===(n=r.randomIndices[r.setIndex])&&(n=Math.floor(Math.random()*t),r.randomIndices.push(n)),r.setIndex+=1):n=0:n=++l%t,l=n,r.nextIndex=l+1,n}}},exportIndices:function(){const n={};return e.forEach(e=>{n[e.name]={},["colors","classes"].forEach(r=>{n[e.name][r]=e.stylings[r].randomIndices})}),n}}}(o,l),h=function(e,n){const t=new RegExp("%%(.+)%%(\\d+)%%(\\d+)%%");return{pickStyle:function(e){for(let o=e.length-1;o>=0;o--){let i;if(i=e[o].match(t)){const e=i[1],t=Number(i[2]),o=Number(i[3]),s=n.find(n=>!(n[1]!=r&&n[1]!==e||n[2]!=r&&n[2]!==t||n[3]!=r&&n[3]!==o));if(void 0!==s)return s[0]}}return null},pickValue:function(n,o,i){const s=n.match(t);if(!s)return n;const c=s[1],l=Number(s[2]),d=Number(s[3]);let a;try{if(void 0===(a=e[c][l].values[d]))throw"error"}catch{return null}const u=o?o.find(e=>!(e[1]!=r&&e[1]!==c||e[2]!=r&&e[2]!==l||e[3]!=r&&e[3]!==d)):null,p=i?i.find(e=>!(e[1]!=r&&e[1]!==c||e[2]!=r&&e[2]!==l||e[3]!=r&&e[3]!==d)):null;return`<span${u?` style="color: ${u[0]}"`:""}${p?` class="${p[0]}"`:""}>${a}</span>`}}}(a,s);console.log("sd",o);const $=Array(n.length);for(const e of n){const n=[],r=i[e.order],t=x.propAccessor(r,h.pickStyle(e.rendering.map(e=>e[3])));"sort"===t.getProp("display")?e.rendering.sort():"orig"===t.getProp("display")&&(e.rendering=u.find(n=>n.name===e.order).elements);for(const r of e.rendering){const[e,o,i,s,c]=r;if("d"!==c){const e=t.getNextIndex("colors"),r=Number.isNaN(e)?"":` color: ${t.getProp("colors","values")[e]};`,c=`class="set-randomizer--element set-randomizer--element-index-${o}-${i}"`,l=t.getProp("block")?" display: block;":"",d=`style="padding: 0px ${t.getProp("fieldPadding")}px;${r}${l}"`,a=h.pickValue(s,t.getProp("colors","rules"),t.getProp("classes","rules"));if(a){const e=t.getProp("block")?`<record ${c} ${d}><div>${y=s,y.replace(RegExp("</div><div>","g"),"<br>").replace(RegExp("<div>","g"),"<br>")}</div></record>`:`<record ${c} ${d}>${a}</record>`;n.push(e)}}}"none"===t.getProp("display")?$[e.order]="":0===n.length||"empty"===t.getProp("display")?$[e.order]=`${t.getProp("openDelim")}`+`${t.getProp("emptySet")}`+`${t.getProp("closeDelim")}`:$[e.order]=`${t.getProp("openDelim")}`+`${n.join(t.getProp("fieldSeparator"))}`+`${t.getProp("closeDelim")}`}var y;let I=d(m);for(const[n,r]of p(m).entries())I=I.replace(e.isRegex?new RegExp(`${e.openDelim}${t(r)}${e.closeDelim}`):`${e.openDelim}${r}${e.closeDelim}`,`${$[n]}`);const S=c(m);if(I.split("%%sr%%ELEMDELIM%%").forEach((e,n)=>S[n].innerHTML=e),"div#clozed"===m){const e=f("div#original").flat();if(e.length>0){const r=n.map(n=>({rendering:n.rendering.map(n=>[n[0],n[1],e.find(e=>e[0]===n[0]&&e[1]===n[1])[2],n[3]]),order:n.order}));g(r,renderDirectives,l,"div#original")}}return x.exportIndices()};return{getElementsOriginal:f,renderSets:g,isInvalid:function(){return o},isContained:function(){return i}}}function i(e,n,r){return e.reduce((e,n,t)=>{const[i,s]=function(e,n,r,t,i,s,c,l,d){o(n,e).getElementsOriginal();return[[t,i,s,c,l,d],!1]}(r?-t-1:t+1,n.inputSyntax,n.defaultStyle,...e[0]);return[i,s||e[1]]},[n,!1])}!function(){const r=$$options;if(window.Persistence)if(Persistence.isAvailable())i(r,function(){const n=Persistence.getItem(e);return n||[[],[],[],[],[],{}]}(),!1);else{const[e,t]=i(r,[[],[],[],[],[],{}],!1);!function(e){e&&!document.querySelector("#set-randomizer--warning")&&document.body.querySelector("#qa").appendChild(n('Set-Randomizer: Anki-Persistence <a href="https://github.com/SimonLammer/anki-persistence">does not work here</a>. Randomization will be inconsistent.'))}(t)}else document.querySelector("#set-randomizer--warning")||document.body.querySelector("#qa").appendChild(n('Set-Randomizer: Anki-Persistence is not defined!\nCheck "Tools > Set Randomizer Options" and make sure you enable "Inject anki-persistence".'))}()}();
